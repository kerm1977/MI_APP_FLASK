{% extends "base.html" %}
{% block content %}
<div class="flex_container">
    <div class="container is-fluid">
        <div class="main-title has-text-centered">
            <h1 class="title ">{{titulo}}</h1>
        </div>
    </div>

    <div class="container">
        <form method="GET" action="{{ url_for('videos') }}" class="mb-4">
            <div class="field has-addons">
                <div class="control is-expanded">
                    <input class="input search_video is-rounded" type="text" name="q" placeholder="Buscar videos..." value="{{ request.args.get('q', '') }}">
                </div>
                <div class="control">
                    <button class="button is-info is-rounded">Buscar</button>
                </div>
            </div>
        </form>

        {% if current_user.is_authenticated %}
        <h1 class="title">Agregar Video</h1>
        <form method="POST" action="/videos">
        </form>
        {% endif %}

        <div class="columns is-multiline">
            {% for video in videos.items %}
            <div class="column is-one-third">
                <div class="card" style="box-shadow: none;">
                    <div class="card-image">
                        <a href="{{ video.video_url }}" target="_blank">
                            {% if video.image_url %}
                            <figure class="image is-16by9">
                                <img class="search_video" src="{{ video.image_url }}" alt="Imagen del video" style="object-fit: cover;">
                            </figure>
                            {% endif %}
                        </a>
                    </div>
                    <div class="card-content">
                        <p class="title">{{ video.title|default('Sin título', true) }}</p>
                        <p class="subtitle">{{ video.detail|default('Sin descripción', true) }}</p>
                        <div class="content">
                            {% if video.video_url %}
                            <a href="{{ video.video_url }}" target="_blank">Ver Video</a>
                            {% else %}
                            <p>No hay URL de video disponible.</p>
                            {% endif %}
                        </div>
                        <hr>
                        <div class="share-buttons">
                            <a href="whatsapp://send?text={{ video.video_url|urlencode }}" target="_blank">
                                <span class="icon-whatsapp"></span>
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ video.video_url|urlencode }}" target="_blank">
                                <span class="icon-facebook"></span>
                            </a>
                            <a href="https://www.instagram.com/" target="_blank">
                                <span class="icon-instagram"></span>
                            </a>
                        </div>
                    </div>
                    {% if current_user.is_authenticated %}
                    <footer class="card-footer">
                        <a href="/videos/edit/{{ video.id }}" class="card-footer-item">Editar</a>
                        <a href="#" class="card-footer-item" onclick="confirmDelete('{{ url_for('delete_video_confirm', video_id=video.id) }}')">Eliminar</a>
                    </footer>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        <nav class="pagination is-centered" role="navigation" aria-label="pagination">
            {% if videos.has_prev %}
            <a class="pagination-previous" href="{{ url_for('videos', page=videos.prev_num) }}">Anterior</a>
            {% endif %}
            {% if videos.has_next %}
            <a class="pagination-next" href="{{ url_for('videos', page=videos.next_num) }}">Siguiente</a>
            {% endif %}
            <ul class="pagination-list">
                {% for page_num in videos.iter_pages() %}
                {% if page_num %}
                {% if videos.page == page_num %}
                <li><a class="pagination-link is-current" aria-label="Page {{ page_num }}">{{ page_num }}</a></li>
                {% else %}
                <li><a class="pagination-link" href="{{ url_for('videos', page=page_num) }}" aria-label="Goto page {{ page_num }}">{{ page_num }}</a></li>
                {% endif %}
                {% else %}
                <li><span class="pagination-ellipsis">&hellip;</span></li>
                {% endif %}
                {% endfor %}
            </ul>
        </nav>
    </div>
    <script>
        function confirmDelete(deleteUrl) {
            if (confirm("¿Estás seguro de que deseas eliminar este video?")) {
                window.location.href = deleteUrl;
            }
        }
    </script>
</body>
{% endblock %}